<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>ğŸš€ Modern Microservice System Architecture in R â€¢ micRo</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="ğŸš€ Modern Microservice System Architecture in R"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">micRo</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/fabiandistler/micRo/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>ğŸš€ Modern Microservice System Architecture in R</h1>
      <small class="dont-index">Source: <a href="https://github.com/fabiandistler/micRo/blob/main/project_plan.md" class="external-link"><code>project_plan.md</code></a></small>
    </div>


<div id="id_-modern-microservice-system-architecture-in-r" class="section level1">

<div class="section level2">
<h2 id="system-overview"><strong>System Overview</strong><a class="anchor" aria-label="anchor" href="#system-overview"></a></h2>
<p>This architecture demonstrates an enterprise-grade microservice ecosystem built entirely in R, optimized for data-intensive operations, ML model serving, and statistical computing services.</p>
<hr></div>
<div class="section level2">
<h2 id="id_ï¸-architecture-diagram"><strong>ğŸ—ï¸ Architecture Diagram</strong><a class="anchor" aria-label="anchor" href="#id_%EF%B8%8F-architecture-diagram"></a></h2>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        API GATEWAY (Kong/Traefik)                â”‚
â”‚                    Load Balancer &amp; Rate Limiting                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                   â”‚              â”‚              â”‚           â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”
â”‚ User   â”‚      â”‚   ML       â”‚  â”‚  Data     â”‚  â”‚ Report  â”‚  â”‚ Real  â”‚
â”‚ Auth   â”‚      â”‚   Model    â”‚  â”‚  Process  â”‚  â”‚ Gen     â”‚  â”‚ Time  â”‚
â”‚ Serviceâ”‚      â”‚   Service  â”‚  â”‚  Service  â”‚  â”‚ Service â”‚  â”‚ Streamâ”‚
â”‚(Plumber2)     â”‚(RestRserve)â”‚  â”‚(Plumber2) â”‚  â”‚(Plumber2â”‚  â”‚(Rest  â”‚
â”‚        â”‚      â”‚            â”‚  â”‚           â”‚  â”‚)        â”‚  â”‚Rserve)â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚                  â”‚              â”‚             â”‚          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                        â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
            â”‚  PostgreSQL â”‚          â”‚    Redis    â”‚
            â”‚   Database  â”‚          â”‚    Cache    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                        â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Event Bus      â”‚      â”‚  Message Queue  â”‚
            â”‚ (RabbitMQ)     â”‚      â”‚  (RabbitMQ)     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                        â”‚              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚ Monitoring   â”‚      â”‚   Logging    â”‚   â”‚  Tracing   â”‚
â”‚ (Prometheus) â”‚      â”‚ (ELK Stack)  â”‚   â”‚  (Jaeger)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<hr></div>
<div class="section level2">
<h2 id="id_-core-microservices"><strong>ğŸ“¦ Core Microservices</strong><a class="anchor" aria-label="anchor" href="#id_-core-microservices"></a></h2>
<div class="section level3">
<h3 id="id_1-user-authentication-service"><strong>1. User Authentication Service</strong><a class="anchor" aria-label="anchor" href="#id_1-user-authentication-service"></a></h3>
<p><strong>Framework:</strong> plumber2<br><strong>Purpose:</strong> JWT-based authentication, OAuth2, user management</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># auth-service/plumber.R</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://plumber2.posit.co/" class="external-link">plumber2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-lib.r-universe.dev/jose" class="external-link">jose</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/pool" class="external-link">pool</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Database connection pool</span></span>
<span><span class="va">db_pool</span> <span class="op">&lt;-</span> <span class="fu">dbPool</span><span class="op">(</span></span>
<span>  <span class="fu">RPostgres</span><span class="fu">::</span><span class="fu">Postgres</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  host <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DB_HOST"</span><span class="op">)</span>,</span>
<span>  dbname <span class="op">=</span> <span class="st">"users"</span>,</span>
<span>  user <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DB_USER"</span><span class="op">)</span>,</span>
<span>  password <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DB_PASSWORD"</span><span class="op">)</span>,</span>
<span>  minSize <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  maxSize <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#* @apiTitle User Authentication Service</span></span>
<span><span class="co">#* @apiDescription Handles user authentication and authorization</span></span>
<span><span class="co">#* @apiVersion 1.0.0</span></span>
<span></span>
<span><span class="co">#* Login endpoint</span></span>
<span><span class="co">#* @post /api/v1/auth/login</span></span>
<span><span class="co">#* @param username:string User's email or username</span></span>
<span><span class="co">#* @param password:string User's password</span></span>
<span><span class="co">#* @serializer json</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">req</span>, <span class="va">res</span>, <span class="va">username</span>, <span class="va">password</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="co"># Validate credentials</span></span>
<span>    <span class="va">user</span> <span class="op">&lt;-</span> <span class="fu">dbGetQuery</span><span class="op">(</span></span>
<span>      <span class="va">db_pool</span>,</span>
<span>      <span class="st">"SELECT id, username, password_hash, role FROM users WHERE username = $1"</span>,</span>
<span>      params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">username</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">user</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">||</span> <span class="op">!</span><span class="fu">bcrypt</span><span class="fu">::</span><span class="fu">checkpw</span><span class="op">(</span><span class="va">password</span>, <span class="va">user</span><span class="op">$</span><span class="va">password_hash</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">res</span><span class="op">$</span><span class="va">status</span> <span class="op">&lt;-</span> <span class="fl">401</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>error <span class="op">=</span> <span class="st">"Invalid credentials"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co"># Generate JWT token</span></span>
<span>    <span class="va">claims</span> <span class="op">&lt;-</span> <span class="fu">jwt_claim</span><span class="op">(</span></span>
<span>      user_id <span class="op">=</span> <span class="va">user</span><span class="op">$</span><span class="va">id</span>,</span>
<span>      username <span class="op">=</span> <span class="va">user</span><span class="op">$</span><span class="va">username</span>,</span>
<span>      role <span class="op">=</span> <span class="va">user</span><span class="op">$</span><span class="va">role</span>,</span>
<span>      exp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fl">3600</span> <span class="op">*</span> <span class="fl">24</span>  <span class="co"># 24 hours</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">token</span> <span class="op">&lt;-</span> <span class="fu">jwt_encode_hmac</span><span class="op">(</span><span class="va">claims</span>, secret <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"JWT_SECRET"</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Log authentication event</span></span>
<span>    <span class="fu">send_to_event_bus</span><span class="op">(</span><span class="st">"auth.login"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      user_id <span class="op">=</span> <span class="va">user</span><span class="op">$</span><span class="va">id</span>,</span>
<span>      timestamp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      token <span class="op">=</span> <span class="va">token</span>,</span>
<span>      user <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">user</span><span class="op">$</span><span class="va">id</span>, username <span class="op">=</span> <span class="va">user</span><span class="op">$</span><span class="va">username</span>, role <span class="op">=</span> <span class="va">user</span><span class="op">$</span><span class="va">role</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">res</span><span class="op">$</span><span class="va">status</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>error <span class="op">=</span> <span class="st">"Internal server error"</span>, message <span class="op">=</span> <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#* Validate token endpoint</span></span>
<span><span class="co">#* @post /api/v1/auth/validate</span></span>
<span><span class="co">#* @param token:string JWT token</span></span>
<span><span class="co">#* @serializer json</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">req</span>, <span class="va">res</span>, <span class="va">token</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">claims</span> <span class="op">&lt;-</span> <span class="fu">jwt_decode_hmac</span><span class="op">(</span><span class="va">token</span>, secret <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"JWT_SECRET"</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">claims</span><span class="op">$</span><span class="va">exp</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">res</span><span class="op">$</span><span class="va">status</span> <span class="op">&lt;-</span> <span class="fl">401</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>error <span class="op">=</span> <span class="st">"Token expired"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>valid <span class="op">=</span> <span class="cn">TRUE</span>, user_id <span class="op">=</span> <span class="va">claims</span><span class="op">$</span><span class="va">user_id</span>, role <span class="op">=</span> <span class="va">claims</span><span class="op">$</span><span class="va">role</span><span class="op">)</span></span>
<span>  <span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">res</span><span class="op">$</span><span class="va">status</span> <span class="op">&lt;-</span> <span class="fl">401</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>valid <span class="op">=</span> <span class="cn">FALSE</span>, error <span class="op">=</span> <span class="st">"Invalid token"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#* Health check</span></span>
<span><span class="co">#* @get /health</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>status <span class="op">=</span> <span class="st">"healthy"</span>, service <span class="op">=</span> <span class="st">"auth"</span>, timestamp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<hr></div>
<div class="section level3">
<h3 id="id_2-ml-model-service-high-performance"><strong>2. ML Model Service (High Performance)</strong><a class="anchor" aria-label="anchor" href="#id_2-ml-model-service-high-performance"></a></h3>
<p><strong>Framework:</strong> RestRserve<br><strong>Purpose:</strong> Serve trained ML models with high throughput</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ml-service/app.R</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://restrserve.org" class="external-link">RestRserve</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/reticulate/" class="external-link">reticulate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Microsoft/LightGBM" class="external-link">lightgbm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jeroen.r-universe.dev/jsonlite" class="external-link">jsonlite</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/promises/" class="external-link">promises</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Enable async processing</span></span>
<span><span class="fu">plan</span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load pre-trained models</span></span>
<span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  classification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"models/classification_model.rds"</span><span class="op">)</span>,</span>
<span>  regression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"models/regression_model.rds"</span><span class="op">)</span>,</span>
<span>  forecast <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"models/forecast_model.rds"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Model cache for hot models</span></span>
<span><span class="va">model_cache</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">new.env</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prediction endpoint</span></span>
<span><span class="va">predict_handler</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">request</span>, <span class="va">response</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">body</span> <span class="op">&lt;-</span> <span class="va">request</span><span class="op">$</span><span class="va">body</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span><span class="va">body</span><span class="op">)</span></span>
<span>    <span class="va">model_type</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">model_type</span></span>
<span>    <span class="va">features</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">features</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Check cache</span></span>
<span>    <span class="va">cache_key</span> <span class="op">&lt;-</span> <span class="fu">digest</span><span class="fu">::</span><span class="fu"><a href="https://eddelbuettel.github.io/digest/man/digest.html" class="external-link">digest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">model_type</span>, <span class="va">features</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="va">cache_key</span>, envir <span class="op">=</span> <span class="va">model_cache</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">cache_key</span>, envir <span class="op">=</span> <span class="va">model_cache</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="co"># Make prediction</span></span>
<span>      <span class="va">model</span> <span class="op">&lt;-</span> <span class="va">models</span><span class="op">[[</span><span class="va">model_type</span><span class="op">]</span><span class="op">]</span></span>
<span>      <span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">features</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="co"># Cache result (with TTL)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="va">cache_key</span>, <span class="va">predictions</span>, envir <span class="op">=</span> <span class="va">model_cache</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co"># Send metrics to monitoring</span></span>
<span>    <span class="fu">send_metric</span><span class="op">(</span><span class="st">"prediction.latency"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">request</span><span class="op">$</span><span class="va">start_time</span><span class="op">)</span></span>
<span>    <span class="fu">send_metric</span><span class="op">(</span><span class="st">"prediction.count"</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">response</span><span class="op">$</span><span class="fu">set_body</span><span class="op">(</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      predictions <span class="op">=</span> <span class="va">predictions</span>,</span>
<span>      model_version <span class="op">=</span> <span class="va">model</span><span class="op">$</span><span class="va">version</span>,</span>
<span>      timestamp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">response</span><span class="op">$</span><span class="fu">set_content_type</span><span class="op">(</span><span class="st">"application/json"</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">response</span><span class="op">$</span><span class="fu">set_status_code</span><span class="op">(</span><span class="fl">500L</span><span class="op">)</span></span>
<span>    <span class="va">response</span><span class="op">$</span><span class="fu">set_body</span><span class="op">(</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>error <span class="op">=</span> <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Batch prediction endpoint (async)</span></span>
<span><span class="va">batch_predict_handler</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">request</span>, <span class="va">response</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">body</span> <span class="op">&lt;-</span> <span class="va">request</span><span class="op">$</span><span class="va">body</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span><span class="va">body</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Process batches asynchronously</span></span>
<span>  <span class="fu">future_promise</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">batches</span>, <span class="kw">function</span><span class="op">(</span><span class="va">batch</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">model</span> <span class="op">&lt;-</span> <span class="va">models</span><span class="op">[[</span><span class="va">batch</span><span class="op">$</span><span class="va">model_type</span><span class="op">]</span><span class="op">]</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">batch</span><span class="op">$</span><span class="va">features</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      batch_id <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">batch_id</span>,</span>
<span>      results <span class="op">=</span> <span class="va">results</span>,</span>
<span>      processed_at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op">%...&gt;%</span> <span class="op">{</span></span>
<span>    <span class="va">response</span><span class="op">$</span><span class="fu">set_body</span><span class="op">(</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">response</span><span class="op">$</span><span class="fu">set_content_type</span><span class="op">(</span><span class="st">"application/json"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Model metrics endpoint</span></span>
<span><span class="va">metrics_handler</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">request</span>, <span class="va">response</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    models_loaded <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">models</span><span class="op">)</span>,</span>
<span>    cache_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="va">model_cache</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    uptime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">app_start_time</span>,</span>
<span>    memory_usage <span class="op">=</span> <span class="fu">pryr</span><span class="fu">::</span><span class="fu">mem_used</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">response</span><span class="op">$</span><span class="fu">set_body</span><span class="op">(</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">metrics</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">response</span><span class="op">$</span><span class="fu">set_content_type</span><span class="op">(</span><span class="st">"application/json"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Create application</span></span>
<span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">Application</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>content_type <span class="op">=</span> <span class="st">"application/json"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add middleware</span></span>
<span><span class="va">app</span><span class="op">$</span><span class="fu">add_middleware</span><span class="op">(</span></span>
<span>  <span class="va">MiddlewareRequestId</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">MiddlewareLogging</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">MiddlewareCORS</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Routes</span></span>
<span><span class="va">app</span><span class="op">$</span><span class="fu">add_post</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"/api/v1/predict"</span>, FUN <span class="op">=</span> <span class="va">predict_handler</span><span class="op">)</span></span>
<span><span class="va">app</span><span class="op">$</span><span class="fu">add_post</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"/api/v1/predict/batch"</span>, FUN <span class="op">=</span> <span class="va">batch_predict_handler</span><span class="op">)</span></span>
<span><span class="va">app</span><span class="op">$</span><span class="fu">add_get</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"/api/v1/metrics"</span>, FUN <span class="op">=</span> <span class="va">metrics_handler</span><span class="op">)</span></span>
<span><span class="va">app</span><span class="op">$</span><span class="fu">add_get</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"/health"</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">request</span>, <span class="va">response</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">response</span><span class="op">$</span><span class="fu">set_body</span><span class="op">(</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>status <span class="op">=</span> <span class="st">"healthy"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Start server</span></span>
<span><span class="va">app_start_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">backend</span> <span class="op">&lt;-</span> <span class="va">BackendRserve</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">backend</span><span class="op">$</span><span class="fu">start</span><span class="op">(</span><span class="va">app</span>, http_port <span class="op">=</span> <span class="fl">8080</span><span class="op">)</span></span></code></pre></div>
<hr></div>
<div class="section level3">
<h3 id="id_3-data-processing-service"><strong>3. Data Processing Service</strong><a class="anchor" aria-label="anchor" href="#id_3-data-processing-service"></a></h3>
<p><strong>Framework:</strong> plumber2<br><strong>Purpose:</strong> ETL operations, data transformations, aggregations</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># data-service/plumber.R</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://plumber2.posit.co/" class="external-link">plumber2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/apache/arrow/" class="external-link">arrow</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/promises/" class="external-link">promises</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plan</span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#* @apiTitle Data Processing Service</span></span>
<span><span class="co">#* @apiDescription High-performance data processing and transformation</span></span>
<span></span>
<span><span class="co"># Parquet file processing endpoint</span></span>
<span><span class="co">#* @post /api/v1/process/parquet</span></span>
<span><span class="co">#* @param file_path:string Path to parquet file</span></span>
<span><span class="co">#* @param operations:array List of operations to perform</span></span>
<span><span class="co">#* @serializer json</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">req</span>, <span class="va">res</span>, <span class="va">file_path</span>, <span class="va">operations</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">future_promise</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="co"># Read parquet file efficiently</span></span>
<span>    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">arrow</span><span class="fu">::</span><span class="fu">read_parquet</span><span class="op">(</span><span class="va">file_path</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Apply operations pipeline</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">op</span> <span class="kw">in</span> <span class="va">operations</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">df</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">op</span><span class="op">$</span><span class="va">type</span>,</span>
<span>        <span class="st">"filter"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">df</span>, <span class="op">!</span><span class="op">!</span><span class="fu">parse_expr</span><span class="op">(</span><span class="va">op</span><span class="op">$</span><span class="va">condition</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="st">"mutate"</span> <span class="op">=</span> <span class="fu">mutate</span><span class="op">(</span><span class="va">df</span>, <span class="op">!</span><span class="op">!</span><span class="fu">parse_expr</span><span class="op">(</span><span class="va">op</span><span class="op">$</span><span class="va">expression</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="st">"aggregate"</span> <span class="op">=</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">df</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="fu">syms</span><span class="op">(</span><span class="va">op</span><span class="op">$</span><span class="va">group_by</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                      <span class="fu">summarize</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="fu">parse_exprs</span><span class="op">(</span><span class="va">op</span><span class="op">$</span><span class="va">metrics</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="st">"join"</span> <span class="op">=</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">df</span>, <span class="fu">read_parquet</span><span class="op">(</span><span class="va">op</span><span class="op">$</span><span class="va">join_path</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">op</span><span class="op">$</span><span class="va">keys</span><span class="op">)</span>,</span>
<span>        <span class="va">df</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co"># Return result</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      rows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>,</span>
<span>      columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>,</span>
<span>      sample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>      processing_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">req</span><span class="op">$</span><span class="va">start_time</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op">%...&gt;%</span> <span class="op">{</span></span>
<span>    <span class="va">res</span><span class="op">$</span><span class="va">body</span> <span class="op">&lt;-</span> <span class="va">.</span></span>
<span>  <span class="op">}</span> <span class="op">%...!%</span> <span class="op">{</span></span>
<span>    <span class="va">res</span><span class="op">$</span><span class="va">status</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span>    <span class="va">res</span><span class="op">$</span><span class="va">body</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Real-time streaming aggregation</span></span>
<span><span class="co">#* @post /api/v1/stream/aggregate</span></span>
<span><span class="co">#* @serializer json</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">req</span>, <span class="va">res</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">stream_data</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span><span class="va">req</span><span class="op">$</span><span class="va">body</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Process streaming data with data.table for speed</span></span>
<span>  <span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu">as.data.table</span><span class="op">(</span><span class="va">stream_data</span><span class="op">$</span><span class="va">events</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Windowed aggregations</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="va">dt</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span></span>
<span>    count <span class="op">=</span> <span class="va">.N</span>,</span>
<span>    mean_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,</span>
<span>    max_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,</span>
<span>    min_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,</span>
<span>    stddev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span></span>
<span>  <span class="op">)</span>, by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span>window <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">timestamp</span>, breaks <span class="op">=</span> <span class="st">"1 min"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Publish to event bus</span></span>
<span>  <span class="fu">publish_event</span><span class="op">(</span><span class="st">"data.aggregated"</span>, <span class="va">results</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    windows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span>,</span>
<span>    aggregations <span class="op">=</span> <span class="va">results</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Data quality check endpoint</span></span>
<span><span class="co">#* @post /api/v1/quality/check</span></span>
<span><span class="co">#* @serializer json</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">req</span>, <span class="va">res</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span><span class="va">req</span><span class="op">$</span><span class="va">body</span><span class="op">)</span><span class="op">$</span><span class="va">data</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">quality_report</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    total_rows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>,</span>
<span>    total_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>,</span>
<span>    missing_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    duplicates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    data_types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">class</span><span class="op">)</span>,</span>
<span>    summary_stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>,</span>
<span>    outliers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">is.numeric</span><span class="op">)</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.75</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>      <span class="va">iqr</span> <span class="op">&lt;-</span> <span class="va">q</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">q</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="op">(</span><span class="va">q</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1.5</span> <span class="op">*</span> <span class="va">iqr</span><span class="op">)</span> <span class="op">|</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="op">(</span><span class="va">q</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1.5</span> <span class="op">*</span> <span class="va">iqr</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">quality_report</span></span>
<span><span class="op">}</span></span></code></pre></div>
<hr></div>
<div class="section level3">
<h3 id="id_4-report-generation-service"><strong>4. Report Generation Service</strong><a class="anchor" aria-label="anchor" href="#id_4-report-generation-service"></a></h3>
<p><strong>Framework:</strong> plumber2<br><strong>Purpose:</strong> Generate PDF reports, dashboards, visualizations</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># report-service/plumber.R</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">library</span>(plumber2)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="fu">library</span>(rmarkdown)</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="fu">library</span>(htmlwidgets)</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#* @apiTitle Report Generation Service</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#* Generate PDF report</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">#* @post /api/v1/reports/pdf</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#* @serializer contentType list(type="application/pdf")</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="cf">function</span>(req, res) {</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>  params <span class="ot">&lt;-</span> jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(req<span class="sc">$</span>body)</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>  </span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>  <span class="co"># Create temporary R Markdown file</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>  rmd_content <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">'</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="st">---</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="st">title: "%s"</span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a><span class="st">author: "%s"</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a><span class="st">date: "%s"</span></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a><span class="st">output: pdf_document</span></span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a><span class="st">params:</span></span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a><span class="st">  data: !r NULL</span></span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a><span class="st">---</span></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a><span class="st">```{r setup, include=FALSE}</span></span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a><span class="st">knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)</span></span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a><span class="st">library(ggplot2)</span></span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a><span class="st">library(knitr)</span></span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a><span class="st">library(dplyr)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="executive-summary">Executive Summary<a class="anchor" aria-label="anchor" href="#executive-summary"></a></h1>
<p><code>{r} data &lt;- params$data summary(data)</code></p>
</div>
<div class="section level1">
<h1 id="visualizations">Visualizations<a class="anchor" aria-label="anchor" href="#visualizations"></a></h1>
<p><code>{r} ggplot(data, aes(x = x, y = y)) +   geom_line() +   theme_minimal() +   labs(title = "Trend Analysis")</code></p>
</div>
<div class="section level1">
<h1 id="detailed-tables">Detailed Tables<a class="anchor" aria-label="anchor" href="#detailed-tables"></a></h1>
<p><code>{r} kable(head(data, 20))</code> â€™, params<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>i</mi><mi>t</mi><mi>l</mi><mi>e</mi><mo>,</mo><mi>p</mi><mi>a</mi><mi>r</mi><mi>a</mi><mi>m</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">title, params</annotation></semantics></math>author, Sys.Date())</p>
<p># Write to temp file tmp_rmd &lt;- tempfile(fileext = â€œ.Rmdâ€) tmp_pdf &lt;- tempfile(fileext = â€œ.pdfâ€) writeLines(rmd_content, tmp_rmd)</p>
<p># Render report rmarkdown::render( tmp_rmd, output_file = tmp_pdf, params = list(data = params$data), quiet = TRUE )</p>
<p># Return PDF readBin(tmp_pdf, â€œrawâ€, n = file.info(tmp_pdf)$size) }</p>
<p>#* Generate interactive dashboard #* @post /api/v1/reports/dashboard #* @serializer html function(req, res) { params &lt;- jsonlite::fromJSON(req<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mi>o</mi><mi>d</mi><mi>y</mi><mo stretchy="false" form="postfix">)</mo><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi><mo>&lt;</mo><mo>âˆ’</mo><mi>a</mi><mi>s</mi><mi>.</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi><mi>.</mi><mi>f</mi><mi>r</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo stretchy="false" form="prefix">(</mo><mi>p</mi><mi>a</mi><mi>r</mi><mi>a</mi><mi>m</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">body)
  data &lt;- as.data.frame(params</annotation></semantics></math>data)</p>
<p># Create interactive plots p1 &lt;- plot_ly(data, x = ~x, y = ~y, type = â€œscatterâ€, mode = â€œlinesâ€) p2 &lt;- plot_ly(data, x = ~category, y = ~value, type = â€œbarâ€)</p>
<p># Combine in dashboard dashboard &lt;- subplot(p1, p2, nrows = 2)</p>
<p># Return HTML htmlwidgets::saveWidget(dashboard, tmp_html &lt;- tempfile(fileext = â€œ.htmlâ€)) readLines(tmp_html) }</p>
<pre><code>
---

### **5. Real-Time Streaming Service**
**Framework:** RestRserve
**Purpose:** WebSocket connections, real-time data feeds

```r
# stream-service/app.R
library(RestRserve)
library(websocket)
library(jsonlite)
library(later)

# WebSocket connection pool
ws_connections &lt;- new.env()

# Stream handler
stream_handler &lt;- function(request, response) {
  ws &lt;- request$websocket

  if (!is.null(ws)) {
    # Generate connection ID
    conn_id &lt;- uuid::UUIDgenerate()
    ws_connections[[conn_id]] &lt;- ws

    # Handle messages
    ws$onMessage(function(binary, message) {
      data &lt;- fromJSON(message)

      # Process streaming data
      result &lt;- process_stream(data)

      # Broadcast to all clients
      broadcast_to_clients(toJSON(result))
    })

    # Handle disconnect
    ws$onClose(function() {
      rm(list = conn_id, envir = ws_connections)
    })
  }
}

# Broadcast function
broadcast_to_clients &lt;- function(message) {
  for (conn in ls(ws_connections)) {
    tryCatch({
      ws_connections[[conn]]$send(message)
    }, error = function(e) {
      # Remove dead connections
      rm(list = conn, envir = ws_connections)
    })
  }
}

# Periodic data push (simulating real-time updates)
later::later(function() {
  # Fetch latest data
  latest_data &lt;- fetch_latest_metrics()
  broadcast_to_clients(toJSON(latest_data))
}, delay = 1, loop = TRUE)

app &lt;- Application$new()
app$add_get(path = "/stream", FUN = stream_handler)</code></pre>
<hr><div class="section level2">
<h2 id="id_-docker-configuration"><strong>ğŸ³ Docker Configuration</strong><a class="anchor" aria-label="anchor" href="#id_-docker-configuration"></a></h2>
<div class="section level3">
<h3 id="individual-service-dockerfile"><strong>Individual Service Dockerfile</strong><a class="anchor" aria-label="anchor" href="#individual-service-dockerfile"></a></h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># Dockerfile for R Microservice</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="kw">FROM</span> rocker/r-ver:4.3.2</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co"># Install system dependencies</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apt-get</span> update <span class="kw">&amp;&amp;</span> <span class="ex">apt-get</span> install <span class="at">-y</span> <span class="dt">\</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    libcurl4-openssl-dev <span class="dt">\</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>    libssl-dev <span class="dt">\</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>    libxml2-dev <span class="dt">\</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>    libpq-dev <span class="dt">\</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>    <span class="kw">&amp;&amp;</span> <span class="fu">rm</span> <span class="at">-rf</span> /var/lib/apt/lists/<span class="pp">*</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co"># Install R packages</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">R</span> <span class="at">-e</span> <span class="st">"install.packages(c('plumber2', 'RestRserve', 'jsonlite', </span><span class="dt">\</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="st">    'DBI', 'RPostgres', 'pool', 'jose', 'bcrypt', 'future', 'promises', </span><span class="dt">\</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="st">    'data.table', 'arrow', 'dplyr', 'ggplot2', 'rmarkdown'), </span><span class="dt">\</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="st">    repos='https://cloud.r-project.org/')"</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="co"># Create app directory</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a><span class="co"># Copy application files</span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a><span class="kw">COPY</span> . /app</span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a><span class="co"># Expose port</span></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a><span class="kw">EXPOSE</span> 8080</span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a><span class="co"># Health check</span></span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a><span class="kw">HEALTHCHECK</span> <span class="op">--interval=30s</span> <span class="op">--timeout=3s</span> <span class="op">--start-period=40s</span> <span class="op">--retries=3</span> \</span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a>  <span class="kw">CMD</span> <span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"httr::GET('http://localhost:8080/health')"</span> <span class="kw">||</span> <span class="bu">exit</span> 1</span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a><span class="co"># Run the service</span></span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">"Rscript"</span>, <span class="st">"run.R"</span>]</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="docker-composeyml"><strong>docker-compose.yml</strong><a class="anchor" aria-label="anchor" href="#docker-composeyml"></a></h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">'3.8'</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">  # API Gateway</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="at">  </span><span class="fu">kong</span><span class="kw">:</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> kong:3.4</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="at">      </span><span class="fu">KONG_DATABASE</span><span class="kw">:</span><span class="at"> postgres</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="at">      </span><span class="fu">KONG_PG_HOST</span><span class="kw">:</span><span class="at"> postgres</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="at">      </span><span class="fu">KONG_PG_DATABASE</span><span class="kw">:</span><span class="at"> kong</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="at">      </span><span class="fu">KONG_PG_USER</span><span class="kw">:</span><span class="at"> kong</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="at">      </span><span class="fu">KONG_PG_PASSWORD</span><span class="kw">:</span><span class="at"> kong</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"8000:8000"</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"8001:8001"</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> postgres</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> microservices</span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a><span class="co">  # Auth Service</span></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a><span class="at">  </span><span class="fu">auth-service</span><span class="kw">:</span></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> ./auth-service</span></span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a><span class="at">      </span><span class="fu">DB_HOST</span><span class="kw">:</span><span class="at"> postgres</span></span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a><span class="at">      </span><span class="fu">DB_USER</span><span class="kw">:</span><span class="at"> postgres</span></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a><span class="at">      </span><span class="fu">DB_PASSWORD</span><span class="kw">:</span><span class="at"> postgres</span></span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a><span class="at">      </span><span class="fu">JWT_SECRET</span><span class="kw">:</span><span class="at"> ${JWT_SECRET}</span></span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"8081:8080"</span></span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> postgres</span></span>
<span id="cb8-33"><a href="#cb8-33" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> redis</span></span>
<span id="cb8-34"><a href="#cb8-34" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb8-35"><a href="#cb8-35" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> microservices</span></span>
<span id="cb8-36"><a href="#cb8-36" tabindex="-1"></a><span class="at">    </span><span class="fu">deploy</span><span class="kw">:</span></span>
<span id="cb8-37"><a href="#cb8-37" tabindex="-1"></a><span class="at">      </span><span class="fu">replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb8-38"><a href="#cb8-38" tabindex="-1"></a><span class="at">      </span><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb8-39"><a href="#cb8-39" tabindex="-1"></a><span class="at">        </span><span class="fu">limits</span><span class="kw">:</span></span>
<span id="cb8-40"><a href="#cb8-40" tabindex="-1"></a><span class="at">          </span><span class="fu">cpus</span><span class="kw">:</span><span class="at"> </span><span class="st">'1'</span></span>
<span id="cb8-41"><a href="#cb8-41" tabindex="-1"></a><span class="at">          </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> 1G</span></span>
<span id="cb8-42"><a href="#cb8-42" tabindex="-1"></a></span>
<span id="cb8-43"><a href="#cb8-43" tabindex="-1"></a><span class="co">  # ML Model Service</span></span>
<span id="cb8-44"><a href="#cb8-44" tabindex="-1"></a><span class="at">  </span><span class="fu">ml-service</span><span class="kw">:</span></span>
<span id="cb8-45"><a href="#cb8-45" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> ./ml-service</span></span>
<span id="cb8-46"><a href="#cb8-46" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb8-47"><a href="#cb8-47" tabindex="-1"></a><span class="at">      </span><span class="fu">REDIS_HOST</span><span class="kw">:</span><span class="at"> redis</span></span>
<span id="cb8-48"><a href="#cb8-48" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb8-49"><a href="#cb8-49" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"8082:8080"</span></span>
<span id="cb8-50"><a href="#cb8-50" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb8-51"><a href="#cb8-51" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> redis</span></span>
<span id="cb8-52"><a href="#cb8-52" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb8-53"><a href="#cb8-53" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> microservices</span></span>
<span id="cb8-54"><a href="#cb8-54" tabindex="-1"></a><span class="at">    </span><span class="fu">deploy</span><span class="kw">:</span></span>
<span id="cb8-55"><a href="#cb8-55" tabindex="-1"></a><span class="at">      </span><span class="fu">replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb8-56"><a href="#cb8-56" tabindex="-1"></a><span class="at">      </span><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb8-57"><a href="#cb8-57" tabindex="-1"></a><span class="at">        </span><span class="fu">limits</span><span class="kw">:</span></span>
<span id="cb8-58"><a href="#cb8-58" tabindex="-1"></a><span class="at">          </span><span class="fu">cpus</span><span class="kw">:</span><span class="at"> </span><span class="st">'4'</span></span>
<span id="cb8-59"><a href="#cb8-59" tabindex="-1"></a><span class="at">          </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> 8G</span></span>
<span id="cb8-60"><a href="#cb8-60" tabindex="-1"></a></span>
<span id="cb8-61"><a href="#cb8-61" tabindex="-1"></a><span class="co">  # Data Processing Service</span></span>
<span id="cb8-62"><a href="#cb8-62" tabindex="-1"></a><span class="at">  </span><span class="fu">data-service</span><span class="kw">:</span></span>
<span id="cb8-63"><a href="#cb8-63" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> ./data-service</span></span>
<span id="cb8-64"><a href="#cb8-64" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb8-65"><a href="#cb8-65" tabindex="-1"></a><span class="at">      </span><span class="fu">DB_HOST</span><span class="kw">:</span><span class="at"> postgres</span></span>
<span id="cb8-66"><a href="#cb8-66" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb8-67"><a href="#cb8-67" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"8083:8080"</span></span>
<span id="cb8-68"><a href="#cb8-68" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb8-69"><a href="#cb8-69" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> data-volume:/data</span></span>
<span id="cb8-70"><a href="#cb8-70" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb8-71"><a href="#cb8-71" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> postgres</span></span>
<span id="cb8-72"><a href="#cb8-72" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb8-73"><a href="#cb8-73" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> microservices</span></span>
<span id="cb8-74"><a href="#cb8-74" tabindex="-1"></a><span class="at">    </span><span class="fu">deploy</span><span class="kw">:</span></span>
<span id="cb8-75"><a href="#cb8-75" tabindex="-1"></a><span class="at">      </span><span class="fu">replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb8-76"><a href="#cb8-76" tabindex="-1"></a></span>
<span id="cb8-77"><a href="#cb8-77" tabindex="-1"></a><span class="co">  # Report Service</span></span>
<span id="cb8-78"><a href="#cb8-78" tabindex="-1"></a><span class="at">  </span><span class="fu">report-service</span><span class="kw">:</span></span>
<span id="cb8-79"><a href="#cb8-79" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> ./report-service</span></span>
<span id="cb8-80"><a href="#cb8-80" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb8-81"><a href="#cb8-81" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"8084:8080"</span></span>
<span id="cb8-82"><a href="#cb8-82" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb8-83"><a href="#cb8-83" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> microservices</span></span>
<span id="cb8-84"><a href="#cb8-84" tabindex="-1"></a><span class="at">    </span><span class="fu">deploy</span><span class="kw">:</span></span>
<span id="cb8-85"><a href="#cb8-85" tabindex="-1"></a><span class="at">      </span><span class="fu">replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span></span>
<span id="cb8-86"><a href="#cb8-86" tabindex="-1"></a></span>
<span id="cb8-87"><a href="#cb8-87" tabindex="-1"></a><span class="co">  # Streaming Service</span></span>
<span id="cb8-88"><a href="#cb8-88" tabindex="-1"></a><span class="at">  </span><span class="fu">stream-service</span><span class="kw">:</span></span>
<span id="cb8-89"><a href="#cb8-89" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> ./stream-service</span></span>
<span id="cb8-90"><a href="#cb8-90" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb8-91"><a href="#cb8-91" tabindex="-1"></a><span class="at">      </span><span class="fu">RABBITMQ_HOST</span><span class="kw">:</span><span class="at"> rabbitmq</span></span>
<span id="cb8-92"><a href="#cb8-92" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb8-93"><a href="#cb8-93" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"8085:8080"</span></span>
<span id="cb8-94"><a href="#cb8-94" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb8-95"><a href="#cb8-95" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> rabbitmq</span></span>
<span id="cb8-96"><a href="#cb8-96" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb8-97"><a href="#cb8-97" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> microservices</span></span>
<span id="cb8-98"><a href="#cb8-98" tabindex="-1"></a></span>
<span id="cb8-99"><a href="#cb8-99" tabindex="-1"></a><span class="co">  # PostgreSQL Database</span></span>
<span id="cb8-100"><a href="#cb8-100" tabindex="-1"></a><span class="at">  </span><span class="fu">postgres</span><span class="kw">:</span></span>
<span id="cb8-101"><a href="#cb8-101" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> postgres:16-alpine</span></span>
<span id="cb8-102"><a href="#cb8-102" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb8-103"><a href="#cb8-103" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_DB</span><span class="kw">:</span><span class="at"> microservices</span></span>
<span id="cb8-104"><a href="#cb8-104" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_USER</span><span class="kw">:</span><span class="at"> postgres</span></span>
<span id="cb8-105"><a href="#cb8-105" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_PASSWORD</span><span class="kw">:</span><span class="at"> postgres</span></span>
<span id="cb8-106"><a href="#cb8-106" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb8-107"><a href="#cb8-107" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> postgres-data:/var/lib/postgresql/data</span></span>
<span id="cb8-108"><a href="#cb8-108" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb8-109"><a href="#cb8-109" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> microservices</span></span>
<span id="cb8-110"><a href="#cb8-110" tabindex="-1"></a></span>
<span id="cb8-111"><a href="#cb8-111" tabindex="-1"></a><span class="co">  # Redis Cache</span></span>
<span id="cb8-112"><a href="#cb8-112" tabindex="-1"></a><span class="at">  </span><span class="fu">redis</span><span class="kw">:</span></span>
<span id="cb8-113"><a href="#cb8-113" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> redis:7-alpine</span></span>
<span id="cb8-114"><a href="#cb8-114" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb8-115"><a href="#cb8-115" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"6379:6379"</span></span>
<span id="cb8-116"><a href="#cb8-116" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb8-117"><a href="#cb8-117" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> microservices</span></span>
<span id="cb8-118"><a href="#cb8-118" tabindex="-1"></a></span>
<span id="cb8-119"><a href="#cb8-119" tabindex="-1"></a><span class="co">  # RabbitMQ Message Broker</span></span>
<span id="cb8-120"><a href="#cb8-120" tabindex="-1"></a><span class="at">  </span><span class="fu">rabbitmq</span><span class="kw">:</span></span>
<span id="cb8-121"><a href="#cb8-121" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> rabbitmq:3-management-alpine</span></span>
<span id="cb8-122"><a href="#cb8-122" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb8-123"><a href="#cb8-123" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"5672:5672"</span></span>
<span id="cb8-124"><a href="#cb8-124" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"15672:15672"</span></span>
<span id="cb8-125"><a href="#cb8-125" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb8-126"><a href="#cb8-126" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> microservices</span></span>
<span id="cb8-127"><a href="#cb8-127" tabindex="-1"></a></span>
<span id="cb8-128"><a href="#cb8-128" tabindex="-1"></a><span class="co">  # Prometheus Monitoring</span></span>
<span id="cb8-129"><a href="#cb8-129" tabindex="-1"></a><span class="at">  </span><span class="fu">prometheus</span><span class="kw">:</span></span>
<span id="cb8-130"><a href="#cb8-130" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> prom/prometheus:latest</span></span>
<span id="cb8-131"><a href="#cb8-131" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb8-132"><a href="#cb8-132" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./prometheus.yml:/etc/prometheus/prometheus.yml</span></span>
<span id="cb8-133"><a href="#cb8-133" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> prometheus-data:/prometheus</span></span>
<span id="cb8-134"><a href="#cb8-134" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb8-135"><a href="#cb8-135" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"9090:9090"</span></span>
<span id="cb8-136"><a href="#cb8-136" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb8-137"><a href="#cb8-137" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> microservices</span></span>
<span id="cb8-138"><a href="#cb8-138" tabindex="-1"></a></span>
<span id="cb8-139"><a href="#cb8-139" tabindex="-1"></a><span class="co">  # Grafana Dashboards</span></span>
<span id="cb8-140"><a href="#cb8-140" tabindex="-1"></a><span class="at">  </span><span class="fu">grafana</span><span class="kw">:</span></span>
<span id="cb8-141"><a href="#cb8-141" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> grafana/grafana:latest</span></span>
<span id="cb8-142"><a href="#cb8-142" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb8-143"><a href="#cb8-143" tabindex="-1"></a><span class="at">      </span><span class="fu">GF_SECURITY_ADMIN_PASSWORD</span><span class="kw">:</span><span class="at"> admin</span></span>
<span id="cb8-144"><a href="#cb8-144" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb8-145"><a href="#cb8-145" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"3000:3000"</span></span>
<span id="cb8-146"><a href="#cb8-146" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb8-147"><a href="#cb8-147" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> grafana-data:/var/lib/grafana</span></span>
<span id="cb8-148"><a href="#cb8-148" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb8-149"><a href="#cb8-149" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> microservices</span></span>
<span id="cb8-150"><a href="#cb8-150" tabindex="-1"></a></span>
<span id="cb8-151"><a href="#cb8-151" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb8-152"><a href="#cb8-152" tabindex="-1"></a><span class="at">  </span><span class="fu">postgres-data</span><span class="kw">:</span></span>
<span id="cb8-153"><a href="#cb8-153" tabindex="-1"></a><span class="at">  </span><span class="fu">data-volume</span><span class="kw">:</span></span>
<span id="cb8-154"><a href="#cb8-154" tabindex="-1"></a><span class="at">  </span><span class="fu">prometheus-data</span><span class="kw">:</span></span>
<span id="cb8-155"><a href="#cb8-155" tabindex="-1"></a><span class="at">  </span><span class="fu">grafana-data</span><span class="kw">:</span></span>
<span id="cb8-156"><a href="#cb8-156" tabindex="-1"></a></span>
<span id="cb8-157"><a href="#cb8-157" tabindex="-1"></a><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb8-158"><a href="#cb8-158" tabindex="-1"></a><span class="at">  </span><span class="fu">microservices</span><span class="kw">:</span></span>
<span id="cb8-159"><a href="#cb8-159" tabindex="-1"></a><span class="at">    </span><span class="fu">driver</span><span class="kw">:</span><span class="at"> bridge</span></span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="id_ï¸-kubernetes-deployment"><strong>â˜¸ï¸ Kubernetes Deployment</strong><a class="anchor" aria-label="anchor" href="#id_%EF%B8%8F-kubernetes-deployment"></a></h2>
<div class="section level3">
<h3 id="auth-service-deploymentyaml"><strong>auth-service-deployment.yaml</strong><a class="anchor" aria-label="anchor" href="#auth-service-deploymentyaml"></a></h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apps/v1</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Deployment</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> auth-service</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> r-microservices</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="at">  </span><span class="fu">replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="at">  </span><span class="fu">selector</span><span class="kw">:</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="at">    </span><span class="fu">matchLabels</span><span class="kw">:</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="at">      </span><span class="fu">app</span><span class="kw">:</span><span class="at"> auth-service</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="at">  </span><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="at">    </span><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="at">      </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="at">        </span><span class="fu">app</span><span class="kw">:</span><span class="at"> auth-service</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="at">        </span><span class="fu">version</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="at">    </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="at">      </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> auth-service</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="at">        </span><span class="fu">image</span><span class="kw">:</span><span class="at"> your-registry/auth-service:v1.0.0</span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a><span class="at">        </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">containerPort</span><span class="kw">:</span><span class="at"> </span><span class="dv">8080</span></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a><span class="at">        </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> DB_HOST</span></span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a><span class="at">          </span><span class="fu">valueFrom</span><span class="kw">:</span></span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a><span class="at">            </span><span class="fu">configMapKeyRef</span><span class="kw">:</span></span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a><span class="at">              </span><span class="fu">name</span><span class="kw">:</span><span class="at"> app-config</span></span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a><span class="at">              </span><span class="fu">key</span><span class="kw">:</span><span class="at"> db.host</span></span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> JWT_SECRET</span></span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a><span class="at">          </span><span class="fu">valueFrom</span><span class="kw">:</span></span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a><span class="at">            </span><span class="fu">secretKeyRef</span><span class="kw">:</span></span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a><span class="at">              </span><span class="fu">name</span><span class="kw">:</span><span class="at"> app-secrets</span></span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a><span class="at">              </span><span class="fu">key</span><span class="kw">:</span><span class="at"> jwt-secret</span></span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a><span class="at">        </span><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a><span class="at">          </span><span class="fu">requests</span><span class="kw">:</span></span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a><span class="at">            </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">"512Mi"</span></span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a><span class="at">            </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">"500m"</span></span>
<span id="cb9-37"><a href="#cb9-37" tabindex="-1"></a><span class="at">          </span><span class="fu">limits</span><span class="kw">:</span></span>
<span id="cb9-38"><a href="#cb9-38" tabindex="-1"></a><span class="at">            </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">"1Gi"</span></span>
<span id="cb9-39"><a href="#cb9-39" tabindex="-1"></a><span class="at">            </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">"1000m"</span></span>
<span id="cb9-40"><a href="#cb9-40" tabindex="-1"></a><span class="at">        </span><span class="fu">livenessProbe</span><span class="kw">:</span></span>
<span id="cb9-41"><a href="#cb9-41" tabindex="-1"></a><span class="at">          </span><span class="fu">httpGet</span><span class="kw">:</span></span>
<span id="cb9-42"><a href="#cb9-42" tabindex="-1"></a><span class="at">            </span><span class="fu">path</span><span class="kw">:</span><span class="at"> /health</span></span>
<span id="cb9-43"><a href="#cb9-43" tabindex="-1"></a><span class="at">            </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">8080</span></span>
<span id="cb9-44"><a href="#cb9-44" tabindex="-1"></a><span class="at">          </span><span class="fu">initialDelaySeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">30</span></span>
<span id="cb9-45"><a href="#cb9-45" tabindex="-1"></a><span class="at">          </span><span class="fu">periodSeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span></span>
<span id="cb9-46"><a href="#cb9-46" tabindex="-1"></a><span class="at">        </span><span class="fu">readinessProbe</span><span class="kw">:</span></span>
<span id="cb9-47"><a href="#cb9-47" tabindex="-1"></a><span class="at">          </span><span class="fu">httpGet</span><span class="kw">:</span></span>
<span id="cb9-48"><a href="#cb9-48" tabindex="-1"></a><span class="at">            </span><span class="fu">path</span><span class="kw">:</span><span class="at"> /health</span></span>
<span id="cb9-49"><a href="#cb9-49" tabindex="-1"></a><span class="at">            </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">8080</span></span>
<span id="cb9-50"><a href="#cb9-50" tabindex="-1"></a><span class="at">          </span><span class="fu">initialDelaySeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb9-51"><a href="#cb9-51" tabindex="-1"></a><span class="at">          </span><span class="fu">periodSeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb9-52"><a href="#cb9-52" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb9-53"><a href="#cb9-53" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb9-54"><a href="#cb9-54" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Service</span></span>
<span id="cb9-55"><a href="#cb9-55" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb9-56"><a href="#cb9-56" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> auth-service</span></span>
<span id="cb9-57"><a href="#cb9-57" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> r-microservices</span></span>
<span id="cb9-58"><a href="#cb9-58" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb9-59"><a href="#cb9-59" tabindex="-1"></a><span class="at">  </span><span class="fu">selector</span><span class="kw">:</span></span>
<span id="cb9-60"><a href="#cb9-60" tabindex="-1"></a><span class="at">    </span><span class="fu">app</span><span class="kw">:</span><span class="at"> auth-service</span></span>
<span id="cb9-61"><a href="#cb9-61" tabindex="-1"></a><span class="at">  </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb9-62"><a href="#cb9-62" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">protocol</span><span class="kw">:</span><span class="at"> TCP</span></span>
<span id="cb9-63"><a href="#cb9-63" tabindex="-1"></a><span class="at">    </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">80</span></span>
<span id="cb9-64"><a href="#cb9-64" tabindex="-1"></a><span class="at">    </span><span class="fu">targetPort</span><span class="kw">:</span><span class="at"> </span><span class="dv">8080</span></span>
<span id="cb9-65"><a href="#cb9-65" tabindex="-1"></a><span class="at">  </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ClusterIP</span></span>
<span id="cb9-66"><a href="#cb9-66" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb9-67"><a href="#cb9-67" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> autoscaling/v2</span></span>
<span id="cb9-68"><a href="#cb9-68" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> HorizontalPodAutoscaler</span></span>
<span id="cb9-69"><a href="#cb9-69" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb9-70"><a href="#cb9-70" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> auth-service-hpa</span></span>
<span id="cb9-71"><a href="#cb9-71" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> r-microservices</span></span>
<span id="cb9-72"><a href="#cb9-72" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb9-73"><a href="#cb9-73" tabindex="-1"></a><span class="at">  </span><span class="fu">scaleTargetRef</span><span class="kw">:</span></span>
<span id="cb9-74"><a href="#cb9-74" tabindex="-1"></a><span class="at">    </span><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apps/v1</span></span>
<span id="cb9-75"><a href="#cb9-75" tabindex="-1"></a><span class="at">    </span><span class="fu">kind</span><span class="kw">:</span><span class="at"> Deployment</span></span>
<span id="cb9-76"><a href="#cb9-76" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> auth-service</span></span>
<span id="cb9-77"><a href="#cb9-77" tabindex="-1"></a><span class="at">  </span><span class="fu">minReplicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb9-78"><a href="#cb9-78" tabindex="-1"></a><span class="at">  </span><span class="fu">maxReplicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span></span>
<span id="cb9-79"><a href="#cb9-79" tabindex="-1"></a><span class="at">  </span><span class="fu">metrics</span><span class="kw">:</span></span>
<span id="cb9-80"><a href="#cb9-80" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> Resource</span></span>
<span id="cb9-81"><a href="#cb9-81" tabindex="-1"></a><span class="at">    </span><span class="fu">resource</span><span class="kw">:</span></span>
<span id="cb9-82"><a href="#cb9-82" tabindex="-1"></a><span class="at">      </span><span class="fu">name</span><span class="kw">:</span><span class="at"> cpu</span></span>
<span id="cb9-83"><a href="#cb9-83" tabindex="-1"></a><span class="at">      </span><span class="fu">target</span><span class="kw">:</span></span>
<span id="cb9-84"><a href="#cb9-84" tabindex="-1"></a><span class="at">        </span><span class="fu">type</span><span class="kw">:</span><span class="at"> Utilization</span></span>
<span id="cb9-85"><a href="#cb9-85" tabindex="-1"></a><span class="at">        </span><span class="fu">averageUtilization</span><span class="kw">:</span><span class="at"> </span><span class="dv">70</span></span>
<span id="cb9-86"><a href="#cb9-86" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> Resource</span></span>
<span id="cb9-87"><a href="#cb9-87" tabindex="-1"></a><span class="at">    </span><span class="fu">resource</span><span class="kw">:</span></span>
<span id="cb9-88"><a href="#cb9-88" tabindex="-1"></a><span class="at">      </span><span class="fu">name</span><span class="kw">:</span><span class="at"> memory</span></span>
<span id="cb9-89"><a href="#cb9-89" tabindex="-1"></a><span class="at">      </span><span class="fu">target</span><span class="kw">:</span></span>
<span id="cb9-90"><a href="#cb9-90" tabindex="-1"></a><span class="at">        </span><span class="fu">type</span><span class="kw">:</span><span class="at"> Utilization</span></span>
<span id="cb9-91"><a href="#cb9-91" tabindex="-1"></a><span class="at">        </span><span class="fu">averageUtilization</span><span class="kw">:</span><span class="at"> </span><span class="dv">80</span></span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="id_-monitoring--observability"><strong>ğŸ“Š Monitoring &amp; Observability</strong><a class="anchor" aria-label="anchor" href="#id_-monitoring--observability"></a></h2>
<div class="section level3">
<h3 id="prometheus-configuration"><strong>Prometheus Configuration</strong><a class="anchor" aria-label="anchor" href="#prometheus-configuration"></a></h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># prometheus.yml</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="fu">global</span><span class="kw">:</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="at">  </span><span class="fu">scrape_interval</span><span class="kw">:</span><span class="at"> 15s</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="at">  </span><span class="fu">evaluation_interval</span><span class="kw">:</span><span class="at"> 15s</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="fu">scrape_configs</span><span class="kw">:</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">job_name</span><span class="kw">:</span><span class="at"> </span><span class="st">'r-microservices'</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="at">    </span><span class="fu">kubernetes_sd_configs</span><span class="kw">:</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">role</span><span class="kw">:</span><span class="at"> pod</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="at">        </span><span class="fu">namespaces</span><span class="kw">:</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="at">          </span><span class="fu">names</span><span class="kw">:</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> r-microservices</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="at">    </span><span class="fu">relabel_configs</span><span class="kw">:</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">source_labels</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">__meta_kubernetes_pod_label_app</span><span class="kw">]</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="at">        </span><span class="fu">action</span><span class="kw">:</span><span class="at"> keep</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="at">        </span><span class="fu">regex</span><span class="kw">:</span><span class="at"> .*-service</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">source_labels</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">__meta_kubernetes_pod_name</span><span class="kw">]</span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a><span class="at">        </span><span class="fu">target_label</span><span class="kw">:</span><span class="at"> pod_name</span></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">source_labels</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">__meta_kubernetes_namespace</span><span class="kw">]</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a><span class="at">        </span><span class="fu">target_label</span><span class="kw">:</span><span class="at"> namespace</span></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">job_name</span><span class="kw">:</span><span class="at"> </span><span class="st">'postgres'</span></span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a><span class="at">    </span><span class="fu">static_configs</span><span class="kw">:</span></span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">targets</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">'postgres:5432'</span><span class="kw">]</span></span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">job_name</span><span class="kw">:</span><span class="at"> </span><span class="st">'redis'</span></span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a><span class="at">    </span><span class="fu">static_configs</span><span class="kw">:</span></span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">targets</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">'redis:6379'</span><span class="kw">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="custom-metrics-in-r"><strong>Custom Metrics in R</strong><a class="anchor" aria-label="anchor" href="#custom-metrics-in-r"></a></h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># metrics.R - Prometheus metrics exporter</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://restrserve.org" class="external-link">RestRserve</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">prometheus</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create metrics</span></span>
<span><span class="va">request_counter</span> <span class="op">&lt;-</span> <span class="fu">prometheus_counter</span><span class="op">(</span></span>
<span>  <span class="st">"http_requests_total"</span>,</span>
<span>  <span class="st">"Total HTTP requests"</span>,</span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"method"</span>, <span class="st">"endpoint"</span>, <span class="st">"status"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">request_duration</span> <span class="op">&lt;-</span> <span class="fu">prometheus_histogram</span><span class="op">(</span></span>
<span>  <span class="st">"http_request_duration_seconds"</span>,</span>
<span>  <span class="st">"HTTP request duration"</span>,</span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"method"</span>, <span class="st">"endpoint"</span><span class="op">)</span>,</span>
<span>  buckets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Middleware to capture metrics</span></span>
<span><span class="va">metrics_middleware</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">request</span>, <span class="va">response</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">start_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Process request</span></span>
<span>  <span class="va">NextMiddleware</span><span class="op">$</span><span class="fu">process_request</span><span class="op">(</span><span class="va">request</span>, <span class="va">response</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Record metrics</span></span>
<span>  <span class="va">duration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">start_time</span><span class="op">)</span></span>
<span>  <span class="va">request_counter</span><span class="op">$</span><span class="fu">inc</span><span class="op">(</span></span>
<span>    method <span class="op">=</span> <span class="va">request</span><span class="op">$</span><span class="va">method</span>,</span>
<span>    endpoint <span class="op">=</span> <span class="va">request</span><span class="op">$</span><span class="va">path</span>,</span>
<span>    status <span class="op">=</span> <span class="va">response</span><span class="op">$</span><span class="va">status_code</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">request_duration</span><span class="op">$</span><span class="fu">observe</span><span class="op">(</span></span>
<span>    <span class="va">duration</span>,</span>
<span>    method <span class="op">=</span> <span class="va">request</span><span class="op">$</span><span class="va">method</span>,</span>
<span>    endpoint <span class="op">=</span> <span class="va">request</span><span class="op">$</span><span class="va">path</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="id_-security-best-practices"><strong>ğŸ” Security Best Practices</strong><a class="anchor" aria-label="anchor" href="#id_-security-best-practices"></a></h2>
<div class="section level3">
<h3 id="id_1-api-gateway-security-kong"><strong>1. API Gateway Security (Kong)</strong><a class="anchor" aria-label="anchor" href="#id_1-api-gateway-security-kong"></a></h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># kong.yml</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="fu">_format_version</span><span class="kw">:</span><span class="at"> </span><span class="st">"3.0"</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> auth-service</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="at">    </span><span class="fu">url</span><span class="kw">:</span><span class="at"> http://auth-service:80</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="at">    </span><span class="fu">routes</span><span class="kw">:</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> auth-route</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="at">        </span><span class="fu">paths</span><span class="kw">:</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> /api/v1/auth</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="at">    </span><span class="fu">plugins</span><span class="kw">:</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> rate-limiting</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="at">        </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="at">          </span><span class="fu">minute</span><span class="kw">:</span><span class="at"> </span><span class="dv">100</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="at">          </span><span class="fu">policy</span><span class="kw">:</span><span class="at"> local</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> cors</span></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="at">        </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a><span class="at">          </span><span class="fu">origins</span><span class="kw">:</span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> </span><span class="st">"*"</span></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a><span class="at">          </span><span class="fu">methods</span><span class="kw">:</span></span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> GET</span></span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> POST</span></span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a><span class="at">          </span><span class="fu">headers</span><span class="kw">:</span></span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> Authorization</span></span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> request-validator</span></span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a><span class="at">        </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a><span class="fu">          body_schema</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb12-28"><a href="#cb12-28" tabindex="-1"></a>            {</span>
<span id="cb12-29"><a href="#cb12-29" tabindex="-1"></a>              "type": "object",</span>
<span id="cb12-30"><a href="#cb12-30" tabindex="-1"></a>              "required": ["username", "password"]</span>
<span id="cb12-31"><a href="#cb12-31" tabindex="-1"></a>            }</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_2-service-to-service-authentication"><strong>2. Service-to-Service Authentication</strong><a class="anchor" aria-label="anchor" href="#id_2-service-to-service-authentication"></a></h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># middleware/jwt_validator.R</span></span>
<span><span class="va">jwt_auth_middleware</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">request</span>, <span class="va">response</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">auth_header</span> <span class="op">&lt;-</span> <span class="va">request</span><span class="op">$</span><span class="va">headers</span><span class="op">$</span><span class="va">Authorization</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">auth_header</span><span class="op">)</span> <span class="op">||</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^Bearer "</span>, <span class="va">auth_header</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">response</span><span class="op">$</span><span class="va">status_code</span> <span class="op">&lt;-</span> <span class="fl">401</span></span>
<span>    <span class="va">response</span><span class="op">$</span><span class="va">body</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>error <span class="op">=</span> <span class="st">"Missing or invalid authorization header"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">token</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"^Bearer "</span>, <span class="st">""</span>, <span class="va">auth_header</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">claims</span> <span class="op">&lt;-</span> <span class="fu">jose</span><span class="fu">::</span><span class="fu">jwt_decode_hmac</span><span class="op">(</span><span class="va">token</span>, secret <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"JWT_SECRET"</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">claims</span><span class="op">$</span><span class="va">exp</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">response</span><span class="op">$</span><span class="va">status_code</span> <span class="op">&lt;-</span> <span class="fl">401</span></span>
<span>      <span class="va">response</span><span class="op">$</span><span class="va">body</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>error <span class="op">=</span> <span class="st">"Token expired"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co"># Attach user info to request</span></span>
<span>    <span class="va">request</span><span class="op">$</span><span class="va">user</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="va">claims</span><span class="op">$</span><span class="va">user_id</span>,</span>
<span>      role <span class="op">=</span> <span class="va">claims</span><span class="op">$</span><span class="va">role</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="cn">TRUE</span></span>
<span>  <span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">response</span><span class="op">$</span><span class="va">status_code</span> <span class="op">&lt;-</span> <span class="fl">401</span></span>
<span>    <span class="va">response</span><span class="op">$</span><span class="va">body</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>error <span class="op">=</span> <span class="st">"Invalid token"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="cn">FALSE</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="id_-deployment-commands"><strong>ğŸš€ Deployment Commands</strong><a class="anchor" aria-label="anchor" href="#id_-deployment-commands"></a></h2>
<div class="section level3">
<h3 id="local-development"><strong>Local Development</strong><a class="anchor" aria-label="anchor" href="#local-development"></a></h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># Start all services with Docker Compose</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="ex">docker-compose</span> up <span class="at">-d</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co"># View logs</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="ex">docker-compose</span> logs <span class="at">-f</span> auth-service</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co"># Scale specific service</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="ex">docker-compose</span> up <span class="at">-d</span> <span class="at">--scale</span> ml-service=5</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="co"># Stop all services</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="ex">docker-compose</span> down</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="production-kubernetes"><strong>Production Kubernetes</strong><a class="anchor" aria-label="anchor" href="#production-kubernetes"></a></h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># Create namespace</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="ex">kubectl</span> create namespace r-microservices</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co"># Apply configurations</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> k8s/configmap.yaml</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> k8s/secrets.yaml</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co"># Deploy services</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> k8s/deployments/</span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="co"># Check status</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="ex">kubectl</span> get pods <span class="at">-n</span> r-microservices</span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="ex">kubectl</span> get svc <span class="at">-n</span> r-microservices</span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a><span class="co"># View logs</span></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a><span class="ex">kubectl</span> logs <span class="at">-f</span> deployment/auth-service <span class="at">-n</span> r-microservices</span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a><span class="co"># Port forwarding for local testing</span></span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a><span class="ex">kubectl</span> port-forward svc/auth-service 8081:80 <span class="at">-n</span> r-microservices</span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="id_-performance-optimization"><strong>ğŸ“ˆ Performance Optimization</strong><a class="anchor" aria-label="anchor" href="#id_-performance-optimization"></a></h2>
<div class="section level3">
<h3 id="id_1-connection-pooling"><strong>1. Connection Pooling</strong><a class="anchor" aria-label="anchor" href="#id_1-connection-pooling"></a></h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># db_pool.R</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/pool" class="external-link">pool</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">create_db_pool</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">dbPool</span><span class="op">(</span></span>
<span>    <span class="fu">RPostgres</span><span class="fu">::</span><span class="fu">Postgres</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    host <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DB_HOST"</span><span class="op">)</span>,</span>
<span>    dbname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DB_NAME"</span><span class="op">)</span>,</span>
<span>    user <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DB_USER"</span><span class="op">)</span>,</span>
<span>    password <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DB_PASSWORD"</span><span class="op">)</span>,</span>
<span>    minSize <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    maxSize <span class="op">=</span> <span class="fl">20</span>,</span>
<span>    idleTimeout <span class="op">=</span> <span class="fl">3600000</span>  <span class="co"># 1 hour</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_2-redis-caching"><strong>2. Redis Caching</strong><a class="anchor" aria-label="anchor" href="#id_2-redis-caching"></a></h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># cache.R</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/richfitz/redux" class="external-link">redux</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">redis_conn</span> <span class="op">&lt;-</span> <span class="fu">redux</span><span class="fu">::</span><span class="fu">hiredis</span><span class="op">(</span></span>
<span>  host <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"REDIS_HOST"</span><span class="op">)</span>,</span>
<span>  port <span class="op">=</span> <span class="fl">6379</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cache_get</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">key</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">redis_conn</span><span class="op">$</span><span class="fu">GET</span><span class="op">(</span><span class="va">key</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">cache_set</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">key</span>, <span class="va">value</span>, <span class="va">ttl</span> <span class="op">=</span> <span class="fl">3600</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">redis_conn</span><span class="op">$</span><span class="fu">SETEX</span><span class="op">(</span><span class="va">key</span>, <span class="va">ttl</span>, <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_3-async-processing"><strong>3. Async Processing</strong><a class="anchor" aria-label="anchor" href="#id_3-async-processing"></a></h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># async.R</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/promises/" class="external-link">promises</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plan</span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fu">availableCores</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">async_process</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">future_promise</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="co"># Heavy computation</span></span>
<span>    <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">complex_analysis</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span>    <span class="va">result</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op">%...&gt;%</span> <span class="op">{</span></span>
<span>    <span class="co"># Success handler</span></span>
<span>    <span class="va">.</span></span>
<span>  <span class="op">}</span> <span class="op">%...!%</span> <span class="op">{</span></span>
<span>    <span class="co"># Error handler</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="id_-testing-strategy"><strong>ğŸ§ª Testing Strategy</strong><a class="anchor" aria-label="anchor" href="#id_-testing-strategy"></a></h2>
<div class="section level3">
<h3 id="unit-tests"><strong>Unit Tests</strong><a class="anchor" aria-label="anchor" href="#unit-tests"></a></h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tests/test_auth_service.R</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://testthat.r-lib.org" class="external-link">testthat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://httr.r-lib.org/" class="external-link">httr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span><span class="st">"Login endpoint returns valid JWT"</span>, <span class="op">{</span></span>
<span>  <span class="va">response</span> <span class="op">&lt;-</span> <span class="fu">POST</span><span class="op">(</span></span>
<span>    <span class="st">"http://localhost:8081/api/v1/auth/login"</span>,</span>
<span>    body <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>username <span class="op">=</span> <span class="st">"test@example.com"</span>, password <span class="op">=</span> <span class="st">"password123"</span><span class="op">)</span>,</span>
<span>    encode <span class="op">=</span> <span class="st">"json"</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html" class="external-link">expect_equal</a></span><span class="op">(</span><span class="fu">status_code</span><span class="op">(</span><span class="va">response</span><span class="op">)</span>, <span class="fl">200</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">content</span> <span class="op">&lt;-</span> <span class="fu">content</span><span class="op">(</span><span class="va">response</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_true</a></span><span class="op">(</span><span class="st">"token"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">content</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_true</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">content</span><span class="op">$</span><span class="va">token</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="integration-tests"><strong>Integration Tests</strong><a class="anchor" aria-label="anchor" href="#integration-tests"></a></h3>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tests/integration/test_e2e_flow.R</span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span><span class="st">"End-to-end prediction flow works"</span>, <span class="op">{</span></span>
<span>  <span class="co"># 1. Authenticate</span></span>
<span>  <span class="va">auth_response</span> <span class="op">&lt;-</span> <span class="fu">POST</span><span class="op">(</span></span>
<span>    <span class="st">"http://localhost:8081/api/v1/auth/login"</span>,</span>
<span>    body <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>username <span class="op">=</span> <span class="st">"test"</span>, password <span class="op">=</span> <span class="st">"test"</span><span class="op">)</span>,</span>
<span>    encode <span class="op">=</span> <span class="st">"json"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">token</span> <span class="op">&lt;-</span> <span class="fu">content</span><span class="op">(</span><span class="va">auth_response</span><span class="op">)</span><span class="op">$</span><span class="va">token</span></span>
<span>  </span>
<span>  <span class="co"># 2. Make prediction</span></span>
<span>  <span class="va">pred_response</span> <span class="op">&lt;-</span> <span class="fu">POST</span><span class="op">(</span></span>
<span>    <span class="st">"http://localhost:8082/api/v1/predict"</span>,</span>
<span>    <span class="fu">add_headers</span><span class="op">(</span>Authorization <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Bearer"</span>, <span class="va">token</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    body <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      model_type <span class="op">=</span> <span class="st">"classification"</span>,</span>
<span>      features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    encode <span class="op">=</span> <span class="st">"json"</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html" class="external-link">expect_equal</a></span><span class="op">(</span><span class="fu">status_code</span><span class="op">(</span><span class="va">pred_response</span><span class="op">)</span>, <span class="fl">200</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_true</a></span><span class="op">(</span><span class="st">"predictions"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu">content</span><span class="op">(</span><span class="va">pred_response</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="load-testing-with-k6"><strong>Load Testing with k6</strong><a class="anchor" aria-label="anchor" href="#load-testing-with-k6"></a></h3>
<div class="sourceCode" id="cb21"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co">// load-test.js</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="im">import</span> http <span class="im">from</span> <span class="st">'k6/http'</span><span class="op">;</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="im">import</span> { check<span class="op">,</span> sleep } <span class="im">from</span> <span class="st">'k6'</span><span class="op">;</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a><span class="im">export</span> <span class="kw">let</span> options <span class="op">=</span> {</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>  <span class="dt">stages</span><span class="op">:</span> [</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>    { <span class="dt">duration</span><span class="op">:</span> <span class="st">'1m'</span><span class="op">,</span> <span class="dt">target</span><span class="op">:</span> <span class="dv">100</span> }<span class="op">,</span></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>    { <span class="dt">duration</span><span class="op">:</span> <span class="st">'3m'</span><span class="op">,</span> <span class="dt">target</span><span class="op">:</span> <span class="dv">100</span> }<span class="op">,</span></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a>    { <span class="dt">duration</span><span class="op">:</span> <span class="st">'1m'</span><span class="op">,</span> <span class="dt">target</span><span class="op">:</span> <span class="dv">200</span> }<span class="op">,</span></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a>    { <span class="dt">duration</span><span class="op">:</span> <span class="st">'3m'</span><span class="op">,</span> <span class="dt">target</span><span class="op">:</span> <span class="dv">200</span> }<span class="op">,</span></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a>    { <span class="dt">duration</span><span class="op">:</span> <span class="st">'1m'</span><span class="op">,</span> <span class="dt">target</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a>  <span class="dt">thresholds</span><span class="op">:</span> {</span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a>    <span class="dt">http_req_duration</span><span class="op">:</span> [<span class="st">'p(95)&lt;500'</span><span class="op">,</span> <span class="st">'p(99)&lt;1000'</span>]<span class="op">,</span></span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a>    <span class="dt">http_req_failed</span><span class="op">:</span> [<span class="st">'rate&lt;0.01'</span>]<span class="op">,</span></span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> () {</span>
<span id="cb21-20"><a href="#cb21-20" tabindex="-1"></a>  <span class="kw">const</span> url <span class="op">=</span> <span class="st">'http://localhost:8082/api/v1/predict'</span><span class="op">;</span></span>
<span id="cb21-21"><a href="#cb21-21" tabindex="-1"></a>  <span class="kw">const</span> payload <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>({</span>
<span id="cb21-22"><a href="#cb21-22" tabindex="-1"></a>    <span class="dt">model_type</span><span class="op">:</span> <span class="st">'classification'</span><span class="op">,</span></span>
<span id="cb21-23"><a href="#cb21-23" tabindex="-1"></a>    <span class="dt">features</span><span class="op">:</span> { <span class="dt">x1</span><span class="op">:</span> [<span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span>]<span class="op">,</span> <span class="dt">x2</span><span class="op">:</span> [<span class="dv">4</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">6</span>] }</span>
<span id="cb21-24"><a href="#cb21-24" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb21-25"><a href="#cb21-25" tabindex="-1"></a>  </span>
<span id="cb21-26"><a href="#cb21-26" tabindex="-1"></a>  <span class="kw">const</span> params <span class="op">=</span> {</span>
<span id="cb21-27"><a href="#cb21-27" tabindex="-1"></a>    <span class="dt">headers</span><span class="op">:</span> { <span class="st">'Content-Type'</span><span class="op">:</span> <span class="st">'application/json'</span> }<span class="op">,</span></span>
<span id="cb21-28"><a href="#cb21-28" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb21-29"><a href="#cb21-29" tabindex="-1"></a>  </span>
<span id="cb21-30"><a href="#cb21-30" tabindex="-1"></a>  <span class="kw">let</span> response <span class="op">=</span> http<span class="op">.</span><span class="fu">post</span>(url<span class="op">,</span> payload<span class="op">,</span> params)<span class="op">;</span></span>
<span id="cb21-31"><a href="#cb21-31" tabindex="-1"></a>  </span>
<span id="cb21-32"><a href="#cb21-32" tabindex="-1"></a>  <span class="fu">check</span>(response<span class="op">,</span> {</span>
<span id="cb21-33"><a href="#cb21-33" tabindex="-1"></a>    <span class="st">'status is 200'</span><span class="op">:</span> (r) <span class="kw">=&gt;</span> r<span class="op">.</span><span class="at">status</span> <span class="op">===</span> <span class="dv">200</span><span class="op">,</span></span>
<span id="cb21-34"><a href="#cb21-34" tabindex="-1"></a>    <span class="st">'response time &lt; 500ms'</span><span class="op">:</span> (r) <span class="kw">=&gt;</span> r<span class="op">.</span><span class="at">timings</span><span class="op">.</span><span class="at">duration</span> <span class="op">&lt;</span> <span class="dv">500</span><span class="op">,</span></span>
<span id="cb21-35"><a href="#cb21-35" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb21-36"><a href="#cb21-36" tabindex="-1"></a>  </span>
<span id="cb21-37"><a href="#cb21-37" tabindex="-1"></a>  <span class="fu">sleep</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb21-38"><a href="#cb21-38" tabindex="-1"></a>}</span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="id_-key-features-summary"><strong>ğŸ¯ Key Features Summary</strong><a class="anchor" aria-label="anchor" href="#id_-key-features-summary"></a></h2>
<p>âœ… <strong>Modern R Frameworks</strong>: plumber2 &amp; RestRserve (2025-ready)<br>
âœ… <strong>High Performance</strong>: Async processing, connection pooling, caching<br>
âœ… <strong>Container Native</strong>: Docker &amp; Kubernetes ready<br>
âœ… <strong>Observability</strong>: Prometheus metrics, distributed tracing, logging<br>
âœ… <strong>Security</strong>: JWT auth, API gateway, service mesh<br>
âœ… <strong>Scalability</strong>: Horizontal auto-scaling, load balancing<br>
âœ… <strong>Cloud Native</strong>: 12-factor app principles, health checks<br>
âœ… <strong>DevOps Ready</strong>: CI/CD pipelines, IaC, monitoring</p>
<hr></div>
<div class="section level2">
<h2 id="id_-additional-resources"><strong>ğŸ“š Additional Resources</strong><a class="anchor" aria-label="anchor" href="#id_-additional-resources"></a></h2>
<ul><li>
<strong>plumber2 Documentation</strong>: <a href="https://www.rplumber.io/" class="external-link uri">https://www.rplumber.io/</a>
</li>
<li>
<strong>RestRserve</strong>: <a href="https://restrserve.org/" class="external-link uri">https://restrserve.org/</a>
</li>
<li>
<strong>Kubernetes R Tutorial</strong>: <a href="https://kubernetes.io/docs/tutorials/" class="external-link uri">https://kubernetes.io/docs/tutorials/</a>
</li>
<li>
<strong>Docker R Images</strong>: <a href="https://hub.docker.com/r/rocker/" class="external-link uri">https://hub.docker.com/r/rocker/</a>
</li>
</ul><hr></div>
</div>


  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by First Last.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

